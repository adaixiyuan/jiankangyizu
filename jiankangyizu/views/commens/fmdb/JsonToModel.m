//
//  JsonToModel.m
//  Json2ModelDemo
//
//  Created by Cailiang on 14-7-24.
//  Copyright (c) 2014å¹´ Home. All rights reserved.
//

#import "JsonToModel.h"
#import <objc/runtime.h>

typedef NS_ENUM(NSInteger, JsonToModelDataType)
{
    JsonToModelDataTypeObject    = 0,
    JsonToModelDataTypeBOOL      = 1,
    JsonToModelDataTypeInteger   = 2,
    JsonToModelDataTypeFloat     = 3,
    JsonToModelDataTypeDouble    = 4,
    JsonToModelDataTypeLong      = 5,
};

@implementation JsonToModel

+ (NSDictionary *)dictionaryFromObject:(id)object
{
    if (object == nil) {
        return nil;
    }
    
    NSMutableDictionary *propertyAndValues = [[NSMutableDictionary alloc] init];
    
    @try {
        NSString *className = NSStringFromClass([object class]);
        id classObject = objc_getClass([className UTF8String]);
        
        unsigned int count = 0;
        objc_property_t *properties = class_copyPropertyList(classObject, &count);
        
        for (int i = 0; i < count; i++)
        {
            objc_property_t property = properties[i];
            NSString *propertyName = [[NSString alloc] initWithCString:property_getName(property) encoding:NSUTF8StringEncoding];
            id propertyValue = nil;
            id valueObject = [object valueForKey:propertyName];
            if ([valueObject isKindOfClass:[NSDictionary class]])
            {
                propertyValue = [NSDictionary dictionaryWithDictionary:valueObject];
            } else if ([valueObject isKindOfClass:[NSArray class]])
            {
                propertyValue = [NSArray arrayWithArray:valueObject];
            } else
            {
                propertyValue = [NSString stringWithFormat:@"%@",[object valueForKey:propertyName]];
            }
            
            [propertyAndValues setObject:propertyValue forKey:propertyName];
        }
    }
    @catch (NSException *exception) {
        NSLog(@"%@",exception);
    }
    @finally {
        return [propertyAndValues copy];
    }
}

+ (NSArray *)propertiesFromObject:(id)object
{
    if (object == nil) {
        return nil;
    }
    
    NSMutableArray *propertiesArray = [[NSMutableArray alloc] init];
    
    @try {
        NSString *className = NSStringFromClass([object class]);
        id classObject = objc_getClass([className UTF8String]);
        
        unsigned int count = 0;
        objc_property_t *properties = class_copyPropertyList(classObject, &count);
        
        for (int i = 0; i < count; i++)
        {
            objc_property_t property = properties[i];
            NSString *propertyName = [[NSString alloc] initWithCString:property_getName(property) encoding:NSUTF8StringEncoding];
            
            [propertiesArray addObject:propertyName];
        }
    }
    @catch (NSException *exception) {
        NSLog(@"%@",exception);
    }
    @finally {
        return [propertiesArray copy];
    }
}

+ (id)objectFromDictionary:(NSDictionary *)dictionary className:(NSString *)name
{
    if (dictionary == nil || name == nil || name.length == 0) {
        return nil;
    }
    
    id object = [[NSClassFromString(name) alloc]init];
    
    @try {
        id classObject = objc_getClass([name UTF8String]);
        
        unsigned int count = 0;
        objc_property_t *properties = class_copyPropertyList(classObject, &count);
        Ivar * ivars = class_copyIvarList(classObject, nil);
        
        for (int i = 0; i < count; i ++)
        {
            NSString *memberName = [NSString stringWithUTF8String:ivar_getName(ivars[i])];
            const char *type = ivar_getTypeEncoding(ivars[i]);
            NSString *dataType =  [NSString stringWithCString:type encoding:NSUTF8StringEncoding];
            
//            NSLog(@"Data %@ type: %@",memberName,dataType);
            
            JsonToModelDataType rtype = JsonToModelDataTypeObject;
            if ([dataType hasPrefix:@"c"])
            {
                // BOOL
                rtype = JsonToModelDataTypeBOOL;
            } else if ([dataType hasPrefix:@"i"])
            {
                // int
                rtype = JsonToModelDataTypeInteger;
            } else if ([dataType hasPrefix:@"f"])
            {
                // float
                rtype = JsonToModelDataTypeFloat;
            } else if ([dataType hasPrefix:@"d"])
            {
                // double
                rtype = JsonToModelDataTypeDouble;
            } else if ([dataType hasPrefix:@"l"])
            {
                // long
                rtype = JsonToModelDataTypeLong;
            }
            
            for (int j = 0; j < count; j ++)
            {
                objc_property_t property = properties[j];
                NSString *propertyName = [[NSString alloc] initWithCString:property_getName(property) encoding:NSUTF8StringEncoding];
                if ([propertyName isEqualToString:@"identity"]) {
                    propertyName = @"id";
                }
                NSRange range = [memberName rangeOfString:propertyName];
                if (range.location == NSNotFound) {
                    continue;
                } else {
                    id propertyValue = [dictionary objectForKey:propertyName];
                    if (propertyValue == [NSNull alloc]) {
                        NSLog(@"NULL YES");
                        switch (rtype) {
                            case JsonToModelDataTypeBOOL:
                            {
//                                BOOL temp = [[NSString stringWithFormat:@"%@",propertyValue] boolValue];
                                propertyValue = [NSNumber numberWithBool:NO];
                            }
                                break;
                            case JsonToModelDataTypeInteger:
                            {
//                                int temp = [[NSString stringWithFormat:@"%@",propertyValue] intValue];
                                propertyValue = [NSNumber numberWithInt:0];
                            }
                                break;
                            case JsonToModelDataTypeFloat:
                            {
//                                float temp = [[NSString stringWithFormat:@"%@",propertyValue] floatValue];
                                propertyValue = [NSNumber numberWithFloat:0.0];
                            }
                                break;
                            case JsonToModelDataTypeDouble:
                            {
//                                double temp = [[NSString stringWithFormat:@"%@",propertyValue] doubleValue];
                                propertyValue = [NSNumber numberWithDouble:0.0];
                            }
                                break;
                            case JsonToModelDataTypeLong:
                            {
//                                long long temp = [[NSString stringWithFormat:@"%@",propertyValue] longLongValue];
                                propertyValue = [NSNumber numberWithLongLong:0];
                            }
                            case JsonToModelDataTypeObject:
                                break;
                                
                            default:
                                break;
                        }
                    }else{
                        switch (rtype) {
                            case JsonToModelDataTypeBOOL:
                            {
                                BOOL temp = [[NSString stringWithFormat:@"%@",propertyValue] boolValue];
                                propertyValue = [NSNumber numberWithBool:temp];
                            }
                                break;
                            case JsonToModelDataTypeInteger:
                            {
                                int temp = [[NSString stringWithFormat:@"%@",propertyValue] intValue];
                                propertyValue = [NSNumber numberWithInt:temp];
                            }
                                break;
                            case JsonToModelDataTypeFloat:
                            {
                                float temp = [[NSString stringWithFormat:@"%@",propertyValue] floatValue];
                                propertyValue = [NSNumber numberWithFloat:temp];
                            }
                                break;
                            case JsonToModelDataTypeDouble:
                            {
                                double temp = [[NSString stringWithFormat:@"%@",propertyValue] doubleValue];
                                propertyValue = [NSNumber numberWithDouble:temp];
                            }
                                break;
                            case JsonToModelDataTypeLong:
                            {
                                long long temp = [[NSString stringWithFormat:@"%@",propertyValue] longLongValue];
                                propertyValue = [NSNumber numberWithLongLong:temp];
                            }
                            case JsonToModelDataTypeObject:
                                break;
                                
                            default:
                                break;
                        }
                        if ([propertyName isEqualToString:@"id"]) {
                            [object setValue:propertyValue forKey:@"identity"];
                        }else{
                            [object setValue:propertyValue forKey:memberName];
                        }
                    }
                   
                    
                    break;
                }
            }
        }
    }
    @catch (NSException *exception) {
        NSLog(@"%@",exception);
    }@finally {
        return object;
    }
}
+ (NSArray *)objectsFromDictionaryArray:(NSArray *)dictionarys className:(NSString *)name{
    NSMutableArray *objecArrays=[[NSMutableArray alloc]initWithCapacity:0];
    for (int j=0; j<[dictionarys count]; j++) {
        NSDictionary *dictionary = [dictionarys objectAtIndex:j];
       [objecArrays addObject:[self objectFromDictionary:dictionary className:name]];
    }
    return objecArrays;
}
/*
 è¿åå¼ï¼è·åå¤ä¾
 */
+ (NSArray *)objectsFromDictionaryData:(NSData *)data className:(NSString *)name{
    if (data !=nil) {
        NSMutableDictionary *dir = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:nil];
        NSString *string=[dir objectForKey:@"resultObject"];
        NSData *datas=[string dataUsingEncoding:NSUTF8StringEncoding];
        NSArray *arry=[NSJSONSerialization JSONObjectWithData:datas options:NSJSONReadingAllowFragments error:nil];
        NSArray *objects=[self objectsFromDictionaryArray:arry className:name];
        return objects;

    }else{
        return [[NSArray alloc]init];
    }
 
//    string	__NSCFString *	@"[{"addDate":1411350375947,"addIp":"119.180.98.134","addUser":"yaxing","applicationConditions":"","brandId":62,"brandName":"æ¬å·äºæå®¢è½¦","catId":132,"catName":"æ°è½æºå®¢è½¦","content":"<p>æ­¤æ¬¾åç½®åå¸å®¢è½¦ç²¾å¿æéæçéç½®ï¼å¼é¡¾å®ç¨ä¸ç»æµæ§ãå¤å½¢è®¾è®¡è´¯ç©¿æ¹ä¸­å¸¦åçè®¾è®¡çå¿µï¼å¤§é¢æ¹æ­£ãæè§åæ¶¦ï¼ç»äººä»¥æºææåãåä¸­å¸¦æçè§è§ææãéç¨å¤§æ²é¢å¨æ¯æ¡é£ç»çï¼è§éå¼éï¼éååè¶³ãè¯¥ç³»åäº§ååºçãè½¦èº«æ¨¡ååè®¾è®¡ï¼é¶é¨ä»¶éç¨æ§ãäºæ¢æ§å¼ºãä¼éååå¤©ç¶æ°åå¨æºï¼æ§è½å¯é ï¼çæ²¹ç»æµï¼ç»´æ¤æ¹ä¾¿ï¼æ»¡è¶³åä¸ªå°åºåä¸åç¨æ·çé</p>","id":853,"img":"","intro":"","isHot":0,"isNew":1,"isShow":1,"modelName":"JS6901G","pubDate":1411350179000,"sid":10,"summary":"","title":"æ°è½æºå®¢è½¦å¬äº¤ï¼æ6ï¼JS6901G","tmpBusLengthId":3,"tmpEngineLocationId":7,"tmpEnginePowerId":11,"tmpMaxSeatNum":41,"tmpMinSeatNum":12,"updateDate":1411437784347,"updateIp":"119.180.98.134","updateUser":"yaxing","uuid":"1b5857b1-ca78-47b9-b2a3-6a722f4e07cd","viewCount":0},{"addDate":1411350171693,"addIp":"119.180.98.134","addUser":"yaxing","applicationConditions":"","brandId":62,"brandName":"æ¬å·äºæå®¢è½¦","catId":132,"catName":"æ°è½æºå®¢è½¦","content":"<p>æ­¤æ¬¾åç½®åå¸å®¢è½¦ç²¾å¿æéæçéç½®ï¼å¼é¡¾å®ç¨ä¸ç»æµæ§ãå¤å½¢è®¾è®¡è´¯ç©¿æ¹ä¸­å¸¦åçè®¾è®¡çå¿µï¼å¤§é¢æ¹æ­£ãæè§åæ¶¦ï¼ç»äººä»¥æºææåãåä¸­å¸¦æçè§è§ææãéç¨å¤§æ²é¢å¨æ¯æ¡é£ç»çï¼è§éå¼éï¼éååè¶³ãè¯¥ç³»åäº§ååºçãè½¦èº«æ¨¡ååè®¾è®¡ï¼é¶é¨ä»¶é"	0x0c56e670
//    
//    string	__NSCFString *	@"[{"addDate":1411376658383,"addIp":"119.180.98.134","addUser":"yaxing","catId":12,"catName":"è¡ä¸å¨æ","content":"<p>ä¸ãèª2014å¹´9æ1æ¥è³2017å¹´12æ31æ¥ï¼å¯¹è´­ç½®çæ°è½æºæ±½è½¦åå¾è½¦è¾è´­ç½®ç¨ã</p><p>\vãäºãå¯¹åå¾è½¦è¾è´­ç½®ç¨çæ°è½æºæ±½è½¦ï¼ç±å·¥ä¸åä¿¡æ¯åé¨ãå½å®¶ç¨å¡æ»å±éè¿åå¸ãåå¾è½¦è¾è´­ç½®ç¨çæ°è½æºæ±½è½¦è½¦åç®å½ãï¼ä»¥ä¸ç®ç§°ãç®å½ãï¼å®æ½ç®¡çã</p><p>åå¥ãç®å½ãçæ°è½æºæ±½è½¦é¡»åæ¶ç¬¦åä»¥ä¸æ¡ä»¶ï¼</p><p>\vãã1.è·å¾è®¸å¯å¨ä¸­å½å¢åéå®ççº¯çµå¨æ±½è½¦ãæçµå¼ï¼å«å¢ç¨å¼ï¼æ··åå¨åæ±½è½¦ãçæçµæ± æ±½è½¦ã</p><p>\vãã2.ä½¿ç¨çå¨åçµæ± ä¸åæ¬éé¸çµæ± ã</p><p>\vãã3.çº¯çµå¨ç»­é©¶éç¨é¡»ç¬¦åè¦æ±ï¼è¯¦æè§å³å¾ï¼ã</p><p>\vãã4.æçµå¼æ··åå¨åä¹ç¨è½¦ç»¼åçææ¶èéï¼ä¸å«çµè½è½¬åççææ¶èéï¼ä¸ç°è¡çå¸¸è§çææ¶èéå½å®¶æ åä¸­å¯¹åºç®æ å¼ç¸æ¯å°äº60%ï¼æçµå¼æ··åå¨ååç¨è½¦ç»¼åçææ¶èéï¼ä¸å«çµè½è½¬åççææ¶èéï¼ä¸ç°è¡çå¸¸è§çææ¶èéå½å®¶æ åä¸­å¯¹åºéå¼ç¸æ¯å°äº60%ã</p><p>\vãã5.éè¿æ°è½æºæ±½è½¦ä¸é¡¹æ£æµï¼ç¬¦åæ°è½æºæ±½è½¦æ åè¦æ±ã</p><p><br/></p>","id":45,"img":"","isShow":1,"linkOther":"","pubDate":1411376504000,"replyCount":0,"shareCount":0,"sid":10,"source":"","subTitle":"å³äºåå¾æ°è½æºæ±½è½¦è½¦è¾è´­ç½®ç¨çå¬å","summary":"ä¸ãèª2014å¹´9æ1æ¥è³2017å¹´12æ31æ¥ï¼å¯¹è´­ç½®çæ°è½æºæ±½è½¦åå¾è½¦è¾è´­ç½®ç¨ã\vãäºãå¯¹åå¾è½¦è¾è´­ç½®ç¨çæ°è½æºæ±½è½¦ï¼ç±å·¥ä¸åä¿¡æ¯åé¨ãå½å®¶ç¨å¡æ»å±éè¿åå¸ãåå¾è½¦è¾è´­ç½®ç¨çæ°è½æºæ±½è½¦è½¦åç®å½ãï¼ä»¥ä¸ç®ç§°ãç®å½ãï¼å®æ½ç®¡çã","title":"å³äºåå¾æ°è½æºæ±½è½¦è½¦è¾è´­ç½®ç¨çå¬å","updateDate":1411376658383,"updateIp":"119.180.98.134","updateUser":"yaxing","uuid":"86d48f75-42c9-4f4b-9cae-e3583cb25ce1","viewCount":0},{"addDate":14113"	0x0c2a5950
    
}

/*
 è¿åå¼ï¼è·ååä¾
 */
+ (id)objectFromDictionaryData:(NSData *)data className:(NSString *)name{
    if (data !=nil) {
        NSMutableDictionary *dir = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:nil];
        NSString *string=[dir objectForKey:@"resultObject"];
        NSData *datas=[string dataUsingEncoding:NSUTF8StringEncoding];
        NSDictionary *dictionary=[NSJSONSerialization JSONObjectWithData:datas options:NSJSONReadingAllowFragments error:nil];
        id object=[self objectFromDictionary:dictionary className:name];
        return object;
        
    }else{
        return nil;
    }
    
    //    string	__NSCFString *	@"[{"addDate":1411350375947,"addIp":"119.180.98.134","addUser":"yaxing","applicationConditions":"","brandId":62,"brandName":"æ¬å·äºæå®¢è½¦","catId":132,"catName":"æ°è½æºå®¢è½¦","content":"<p>æ­¤æ¬¾åç½®åå¸å®¢è½¦ç²¾å¿æéæçéç½®ï¼å¼é¡¾å®ç¨ä¸ç»æµæ§ãå¤å½¢è®¾è®¡è´¯ç©¿æ¹ä¸­å¸¦åçè®¾è®¡çå¿µï¼å¤§é¢æ¹æ­£ãæè§åæ¶¦ï¼ç»äººä»¥æºææåãåä¸­å¸¦æçè§è§ææãéç¨å¤§æ²é¢å¨æ¯æ¡é£ç»çï¼è§éå¼éï¼éååè¶³ãè¯¥ç³»åäº§ååºçãè½¦èº«æ¨¡ååè®¾è®¡ï¼é¶é¨ä»¶éç¨æ§ãäºæ¢æ§å¼ºãä¼éååå¤©ç¶æ°åå¨æºï¼æ§è½å¯é ï¼çæ²¹ç»æµï¼ç»´æ¤æ¹ä¾¿ï¼æ»¡è¶³åä¸ªå°åºåä¸åç¨æ·çé</p>","id":853,"img":"","intro":"","isHot":0,"isNew":1,"isShow":1,"modelName":"JS6901G","pubDate":1411350179000,"sid":10,"summary":"","title":"æ°è½æºå®¢è½¦å¬äº¤ï¼æ6ï¼JS6901G","tmpBusLengthId":3,"tmpEngineLocationId":7,"tmpEnginePowerId":11,"tmpMaxSeatNum":41,"tmpMinSeatNum":12,"updateDate":1411437784347,"updateIp":"119.180.98.134","updateUser":"yaxing","uuid":"1b5857b1-ca78-47b9-b2a3-6a722f4e07cd","viewCount":0},{"addDate":1411350171693,"addIp":"119.180.98.134","addUser":"yaxing","applicationConditions":"","brandId":62,"brandName":"æ¬å·äºæå®¢è½¦","catId":132,"catName":"æ°è½æºå®¢è½¦","content":"<p>æ­¤æ¬¾åç½®åå¸å®¢è½¦ç²¾å¿æéæçéç½®ï¼å¼é¡¾å®ç¨ä¸ç»æµæ§ãå¤å½¢è®¾è®¡è´¯ç©¿æ¹ä¸­å¸¦åçè®¾è®¡çå¿µï¼å¤§é¢æ¹æ­£ãæè§åæ¶¦ï¼ç»äººä»¥æºææåãåä¸­å¸¦æçè§è§ææãéç¨å¤§æ²é¢å¨æ¯æ¡é£ç»çï¼è§éå¼éï¼éååè¶³ãè¯¥ç³»åäº§ååºçãè½¦èº«æ¨¡ååè®¾è®¡ï¼é¶é¨ä»¶é"	0x0c56e670
    //
    //    string	__NSCFString *	@"[{"addDate":1411376658383,"addIp":"119.180.98.134","addUser":"yaxing","catId":12,"catName":"è¡ä¸å¨æ","content":"<p>ä¸ãèª2014å¹´9æ1æ¥è³2017å¹´12æ31æ¥ï¼å¯¹è´­ç½®çæ°è½æºæ±½è½¦åå¾è½¦è¾è´­ç½®ç¨ã</p><p>\vãäºãå¯¹åå¾è½¦è¾è´­ç½®ç¨çæ°è½æºæ±½è½¦ï¼ç±å·¥ä¸åä¿¡æ¯åé¨ãå½å®¶ç¨å¡æ»å±éè¿åå¸ãåå¾è½¦è¾è´­ç½®ç¨çæ°è½æºæ±½è½¦è½¦åç®å½ãï¼ä»¥ä¸ç®ç§°ãç®å½ãï¼å®æ½ç®¡çã</p><p>åå¥ãç®å½ãçæ°è½æºæ±½è½¦é¡»åæ¶ç¬¦åä»¥ä¸æ¡ä»¶ï¼</p><p>\vãã1.è·å¾è®¸å¯å¨ä¸­å½å¢åéå®ççº¯çµå¨æ±½è½¦ãæçµå¼ï¼å«å¢ç¨å¼ï¼æ··åå¨åæ±½è½¦ãçæçµæ± æ±½è½¦ã</p><p>\vãã2.ä½¿ç¨çå¨åçµæ± ä¸åæ¬éé¸çµæ± ã</p><p>\vãã3.çº¯çµå¨ç»­é©¶éç¨é¡»ç¬¦åè¦æ±ï¼è¯¦æè§å³å¾ï¼ã</p><p>\vãã4.æçµå¼æ··åå¨åä¹ç¨è½¦ç»¼åçææ¶èéï¼ä¸å«çµè½è½¬åççææ¶èéï¼ä¸ç°è¡çå¸¸è§çææ¶èéå½å®¶æ åä¸­å¯¹åºç®æ å¼ç¸æ¯å°äº60%ï¼æçµå¼æ··åå¨ååç¨è½¦ç»¼åçææ¶èéï¼ä¸å«çµè½è½¬åççææ¶èéï¼ä¸ç°è¡çå¸¸è§çææ¶èéå½å®¶æ åä¸­å¯¹åºéå¼ç¸æ¯å°äº60%ã</p><p>\vãã5.éè¿æ°è½æºæ±½è½¦ä¸é¡¹æ£æµï¼ç¬¦åæ°è½æºæ±½è½¦æ åè¦æ±ã</p><p><br/></p>","id":45,"img":"","isShow":1,"linkOther":"","pubDate":1411376504000,"replyCount":0,"shareCount":0,"sid":10,"source":"","subTitle":"å³äºåå¾æ°è½æºæ±½è½¦è½¦è¾è´­ç½®ç¨çå¬å","summary":"ä¸ãèª2014å¹´9æ1æ¥è³2017å¹´12æ31æ¥ï¼å¯¹è´­ç½®çæ°è½æºæ±½è½¦åå¾è½¦è¾è´­ç½®ç¨ã\vãäºãå¯¹åå¾è½¦è¾è´­ç½®ç¨çæ°è½æºæ±½è½¦ï¼ç±å·¥ä¸åä¿¡æ¯åé¨ãå½å®¶ç¨å¡æ»å±éè¿åå¸ãåå¾è½¦è¾è´­ç½®ç¨çæ°è½æºæ±½è½¦è½¦åç®å½ãï¼ä»¥ä¸ç®ç§°ãç®å½ãï¼å®æ½ç®¡çã","title":"å³äºåå¾æ°è½æºæ±½è½¦è½¦è¾è´­ç½®ç¨çå¬å","updateDate":1411376658383,"updateIp":"119.180.98.134","updateUser":"yaxing","uuid":"86d48f75-42c9-4f4b-9cae-e3583cb25ce1","viewCount":0},{"addDate":14113"	0x0c2a5950
    
}
/*
 å¤æ­è¿åå¼æ¯å¦æå
 */
+ (BOOL)ifSuccessFromDictionaryData:(NSData *)data{
    NSMutableDictionary *dir = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:nil];
    NSString *string=[dir objectForKey:@"resultCode"];
    if ([string isEqualToString:@"0001"]) {
        return YES;
    }else{
        return NO;
    }
}

/*
 è·ååå°çè¿åmessage
 */
+ (NSString *)getMessageFromDictionaryData:(NSData *)data{
    NSMutableDictionary *dir = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:nil];
    NSString *string=[dir objectForKey:@"resultMessage"];
    return string;
}
/*
 è·åè¿åçä¸ªæ°
 */
+ (int)getCountFromDictionaryData:(NSData *)data{
    NSMutableDictionary *dir = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:nil];
    int count=[[dir objectForKey:@"totalCount"] intValue];
    return count;
}
/*
 è¿åDictionary
 */
+ (NSDictionary *)getDictionaryFromDictionaryData:(NSData *)data{
     NSMutableDictionary *dir = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:nil];
    return dir;
}
/*
 è·åjsonæ ¼å¼çArray
 */
+ (NSArray *)jsonObjectsFromDictionaryData:(NSData *)data{
    NSMutableDictionary *dir = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:nil];
    NSString *string=[dir objectForKey:@"resultObject"];
    NSData *datas=[string dataUsingEncoding:NSUTF8StringEncoding];
    NSArray *arry=[NSJSONSerialization JSONObjectWithData:datas options:NSJSONReadingAllowFragments error:nil];
    return arry;
}



/*
 è¿åå¼ï¼è·åå¤ä¾
 */
+ (NSArray *)objectsFromDictionary:(NSDictionary *)dictionary className:(NSString *)name{
    NSString *string=[dictionary objectForKey:@"resultObject"];
    NSData *datas=[string dataUsingEncoding:NSUTF8StringEncoding];
    NSArray *arry=[NSJSONSerialization JSONObjectWithData:datas options:NSJSONReadingAllowFragments error:nil];
    
    NSArray *objects=[self objectsFromDictionaryArray:arry className:name];
    return objects;
}

/*
 å¤æ­è¿åå¼æ¯å¦æå
 */
+ (BOOL)ifSuccessFromDictionary:(NSDictionary *)dictionary{
    NSString *string=[dictionary objectForKey:@"resultCode"];
    if ([string isEqualToString:@"0001"]) {
        return YES;
    }else{
        return NO;
    }
}

/*
 è·ååå°çè¿åmessage
 */
+ (NSString *)getMessageFromDictionary:(NSDictionary *)dictionary{
    NSString *string=[dictionary objectForKey:@"resultMessage"];
    return string;
}
/*
 è·åè¿åçä¸ªæ°
 */
+ (int)getCountFromDictionary:(NSDictionary *)dictionary{

    int count=(int)[dictionary objectForKey:@"totalCount"];
    return count;
}

//å¯¹è±¡è½¬json
+(NSString *)getJsonStringFromOne:(id)obj{
    NSData *jsonData =   [self getJSON:obj options:NSJSONWritingPrettyPrinted error:nil];
    NSString *jsonString = [[NSString alloc]initWithData:jsonData encoding:NSUTF8StringEncoding];
    return jsonString;
}
+(NSString *)getJsonStringFromArray:(NSArray *)array{
    NSMutableString *string = [[NSMutableString alloc]init];
    [string appendString:@"["];
    for (int i=0; i<[array count]; i++) {
        [string appendString:[self getJsonStringFromOne:[array objectAtIndex:i]]];
        if (i< [array count]-1) {
            [string appendString:@","];
        }
    }
    [string appendString:@"]"];
    return string;
}

+ (NSDictionary*)getObjectData:(id)obj
{
    NSMutableDictionary *dic = [NSMutableDictionary dictionary];
    unsigned int propsCount;
    objc_property_t *props = class_copyPropertyList([obj class], &propsCount);
    for(int i = 0;i < propsCount; i++)
    {
        objc_property_t prop = props[i];
        
        NSString *propName = [NSString stringWithUTF8String:property_getName(prop)];
        id value = [obj valueForKey:propName];
        if(value == nil)
        {
            value = @"";
        }
        else
        {
            value = [self getObjectInternal:value];
//            NSString *namelowser = [self replaceLower:propName];
            NSString *namelowser = propName;

            if ([namelowser isEqualToString:@"identity"]) {
                namelowser  = @"id";
            }
            [dic setObject:value forKey:namelowser];
        }
        
    }
    return dic;
}
+(NSString *)replaceLower:(NSString *)str{
    NSMutableString *ms=[[NSMutableString alloc]init];
    char c[50];
    strcpy(c,(char *)[str UTF8String]);
    
    for (int i = 0; c != nil && i < str.length; i++) {
        if (c[i] < 97 && c[i] > 57) {
            [ms appendFormat:[NSString stringWithFormat:@"_%c",c[i]]];
        } else {
            [ms appendFormat:[NSString stringWithFormat:@"%c",c[i]]];
        }
    }
    
    str=[ms lowercaseString];
    
    return str;
}
+ (void)print:(id)obj
{
    NSLog(@"%@", [self getObjectData:obj]);
}


+ (NSData*)getJSON:(id)obj options:(NSJSONWritingOptions)options error:(NSError**)error
{
    return [NSJSONSerialization dataWithJSONObject:[self getObjectData:obj] options:options error:error];
}

+ (id)getObjectInternal:(id)obj
{
    if([obj isKindOfClass:[NSString class]]
       || [obj isKindOfClass:[NSNumber class]]
       || [obj isKindOfClass:[NSNull class]])
    {
        return obj;
    }
    
    if([obj isKindOfClass:[NSArray class]])
    {
        NSArray *objarr = obj;
        NSMutableArray *arr = [NSMutableArray arrayWithCapacity:objarr.count];
        for(int i = 0;i < objarr.count; i++)
        {
            [arr setObject:[self getObjectInternal:[objarr objectAtIndex:i]] atIndexedSubscript:i];
        }
        return arr;
    }
    if([obj isKindOfClass:[NSDictionary class]])
    {
        NSDictionary *objdic = obj;
        NSMutableDictionary *dic = [NSMutableDictionary dictionaryWithCapacity:[objdic count]];
        for(NSString *key in objdic.allKeys)
        {
            [dic setObject:[self getObjectInternal:[objdic objectForKey:key]] forKey:key];
        }
        return dic;
    }
    return [self getObjectData:obj];
}

@end
